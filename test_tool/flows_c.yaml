Flows:
  HAS-Any-Discovery-Default:
    desc: HEART AS configuration discovery
    profile: ..T
    sequence:
      - Discovery:
          set_discovery_issuer: null
    assert:
      verify-response:
        response_cls:
          - ProviderConfigurationResponse
          - ASConfigurationResponse
        claims:
          - issuer
          - authorization_endpoint
          - token_endpoint
          - introspection_endpoint
          - revocation_endpoint
          - jwks_uri
      verify-cache-header: null
      verify-jwks: null
  HAS-Any-Registration-Default:
    desc: HEART client registration
    profile: ..T
    sequence:
      - Discovery:
          set_discovery_issuer: null
      - Registration:
          set_request_args:
            token_endpoint_auth_method: private_key_jwt
          set_jwks_uri: null
    assert:
      verify-response:
        response_cls:
          - ClientInfoResponse
          - RegistrationResponse
  HAS-Code-Access_token-Default:
    desc: Access token request with private_key_jwt authentication
    profile: C..T
    sequence:
      - Discovery:
          set_discovery_issuer: null
      - Registration:
          set_request_args:
            token_endpoint_auth_method: private_key_jwt
          set_jwks_uri: null
      - AsyncAuthn
      - AccessToken:
          check_support:
            WARNING:
              token_endpoint_auth_methods_supported: private_key_jwt
          set_op_args:
            authn_method: private_key_jwt
    assert:
      verify-response:
        response_cls:
          - AccessTokenResponse
        not_claims:
          - refresh_token
      verify-tokens: null
  HAS-Code-Access_token-OfflineAccess:
    desc: Authorization request with scope=offline_access
    profile: C..T
    sequence:
      - Discovery:
          set_discovery_issuer: null
      - Registration:
          set_request_args:
            token_endpoint_auth_method: private_key_jwt
          set_jwks_uri: null
      - AsyncAuthn:
          set_request_args:
            scope: offline_access
      - AccessToken:
          check_support:
            WARNING:
              token_endpoint_auth_methods_supported: private_key_jwt
          set_op_args:
            authn_method: private_key_jwt
    assert:
      verify-response:
        response_cls:
          - AccessTokenResponse
        claims:
          - refresh_token
      verify-tokens: null
  HAS-Code-Access_token-introspection:
    desc: The AS must supply token introspection endpoint
    profile: C..T
    sequence:
      - Discovery:
          set_discovery_issuer: null
      - Registration:
          set_request_args:
            token_endpoint_auth_method: private_key_jwt
          set_jwks_uri: null
      - AsyncAuthn
      - AccessToken:
          check_support:
            WARNING:
              token_endpoint_auth_methods_supported: private_key_jwt
          set_op_args:
            authn_method: private_key_jwt
      - TokenIntrospection:
          set_op_args:
            authn_method: private_key_jwt
    assert:
      verify-response:
        response_cls:
          - TokenIntrospectionResponse
  HAS-Code-Access_token-revocation:
    desc: The AS must supply token revocation endpoint
    profile: C..T
    sequence:
      - Discovery:
          set_discovery_issuer: null
      - Registration:
          set_request_args:
            token_endpoint_auth_method: private_key_jwt
          set_jwks_uri: null
      - AsyncAuthn
      - AccessToken:
          check_support:
            WARNING:
              token_endpoint_auth_methods_supported: private_key_jwt
          set_op_args:
            authn_method: private_key_jwt
      - TokenRevocation:
          set_op_args:
            authn_method: private_key_jwt
      - TokenIntrospection:
          set_op_args:
            authn_method: private_key_jwt
    assert:
      http_response:
        status_code: 400
Order:
  - HAS-Any-Discovery
  - HAS-Any-Registration
  - HAS-Code-Access_token
Desc:
  Access_token: 'Access Token Request'
  Discovery: 'AS configuration discovery'
  Registration: 'Dynamic Client registration'